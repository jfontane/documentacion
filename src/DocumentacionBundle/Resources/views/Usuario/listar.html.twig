{% set activo = "usuarios" %}
{% extends "@Documentacion/layout.html.twig" %}
{% block title %}Listado de Usuarios{% endblock %}
{% block pageid 'admin' %}

{% block body %}
        {# CONTENIDO ORIGINAL DEL ARCHIVO Y SIN LAS ETIQUETAS <html><body> � </body></html> #}

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Usuarios</li>
            </ol>
        </nav>
        <!-- MENSAJES FLASH ADMIN AQUÍ (utilizar <div class=”flash_admin”> </div>) -->
        <div class="alert alert-danger" role="alert" >
            {% for mensaje in app.session.flashbag.get('warn') %}
                <p class="warn">{{ mensaje }}</p>
            {% endfor %}
        </div>
        <div class="mt-4">
            Se encontraron {{ pagination.getTotalItemCount() }} Usuario(es).
        </div>
        <div class="grid_16">
                {% for usuario in pagination %}
                          <div class="alert alert-primary" role="alert">
                          <p><b>Usuario:&nbsp;</b>{{ usuario.username }} <b><a href="{{ path('usuario_editar_email',{'id':usuario.id}) }}"><i class="material-icons">edit</i></a></b>&nbsp;&nbsp;
                            <b><a id='btn_borrar'  href="{{ path('admin_usuario_eliminar', {'id': usuario.id }) }}"><i class="material-icons">delete</i></a></b>
                          </p>
                          <p><b>Roles:&nbsp;</b> {{ usuario.roles[0] }}</p>
                          <p><b>Fecha que se Registr&oacute;:</b>&nbsp;

                              {% if usuario.fechaRegistracion == NULL %}
                                     <font color='red'>NO se ha Registrado.</font>
                              {% else %}
                                    <font color='blue'>    {{ usuario.fechaRegistracion|date("Y-m-d H:i:s") }} </font>
                              {% endif %}

                            </p>
                                <table class="table">
                                  <thead class="thead-dark">
                                    <tr>
                                      <th>CUIL</th>
                                      <th>Periodo</th>
                                      <th>Leido</th>
                                      <th>Archivo</th>
                                      <th>Descripcion</th>
                                      <th>Acciones</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                  {% for documento in usuario.documentos %}
                                  {% if (documento.activo == 'Si') %}
                                      <tr>
                                        <td>{{documento.cuil}}</td>
                                        <td>{{documento.periodoAnio}}/{{documento.periodoMes}}</td>
                                        <td>
                                          {% if documento.cantidadVisitas > 0 %}
                                          <i class="material-icons">done_all</i>
                                          {% else %}
                                          <!-- <i class="material-icons">done</i> -->
                                          {% endif %}
                                        </td>
                                        <td>{{documento.archivo}}</td>
                                        <td>{{documento.descripcion}}</td>
                                        <td><a href="{{ path('documento_descargar',{'id':documento.id}) }}"><i class="material-icons">picture_as_pdf</i></a></td>
                                      </tr>
                                  {% endif %}
                                {% else %}
                                <tr>
                                  <td colspan="5">No tiene Documento Asociado.</td>
                                </tr>
                                {% endfor %}
                                </tbody>
                                </table>
                              </div>

                    {% else %}
                      No existe ninguna Usuario.
                    {% endfor %}
            <div class="navigation">
                {{ knp_pagination_render(pagination) }}
            </div>

        </div>

    {% endblock %}
    {% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            $('a[id=btn_borrar]').on('click', function () {
                event.preventDefault();
                url = $(this).attr('href');
                if (confirm('Esta seguro de Eliminar el Usuario??')) {
                    $(location).attr('href', url);
                }
            });
        });
    </script>
    {% endblock %}
